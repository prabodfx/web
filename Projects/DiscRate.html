<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Price Calculator</title>

  <style>
    /* === Global Reset === */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Roboto, sans-serif;
      background: radial-gradient(circle at top, #1e1b4b, #0f172a);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 1rem;
      color: #fff;
      overflow-x: hidden; /* Prevent horizontal scroll due to padding/margin */
    }

    .card {
      width: 100%;
      max-width: 550px; /* Kept max-width as per original design */
      padding: 2rem;
      border-radius: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 20px 45px rgba(0,0,0,0.7);
      animation: fadeIn 0.8s ease;
      transition: max-width 0.3s ease-out; /* Added transition for smooth effect */
    }

    /* NEW CSS: Wider card style */
    .wider-card {
      max-width: 800px; /* Increased width for larger numbers */
    }

    @media (max-width: 480px) {
      .card {
        margin-bottom: 2.05rem; 
      }
      .wider-card {
        max-width: 95%; /* Keep it within small screen bounds */
      }
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(25px);}
      to {opacity: 1; transform: translateY(0);}
    }

    h1 {
      font-size: clamp(1.6rem, 4vw, 2.2rem);
      font-weight: 700;
      margin-bottom: .5rem;
      text-align: center;
      background: linear-gradient(90deg, #ffffff, #00ff04);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    p.sub {
      text-align: center;
      color: #aaa;
      margin-bottom: 2rem;
      font-size: clamp(0.85rem, 2vw, 1rem);
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      color: #ddd;
    }

    .input-group {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .input-group span {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #999;
      font-size: 0.9rem;
    }

    input {
      width: 100%;
      padding: 0.9rem 0.9rem 0.9rem 2.5rem;
      border-radius: 0.8rem;
      border: 1px solid #444;
      background: #1e293b;
      color: #fff;
      font-size: 1rem;
      outline: none;
      transition: border 0.3s, box-shadow 0.3s;
    }

    input:focus {
      border-color: #9333ea;
      box-shadow: 0 0 0 2px rgba(147, 51, 234, 0.4);
    }

    button {
      width: 100%;
      padding: 1rem;
      border: none;
      border-radius: 0.8rem;
      font-size: 1.1rem;
      font-weight: bold;
      color: #fff;
      background: linear-gradient(90deg, #6d28d9, #9333ea);
      cursor: pointer;
      transition: transform 0.25s, box-shadow 0.25s;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 30px rgba(147, 51, 234, 0.6);
    }

    #result-container {
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid #333;
      display: none;
      text-align: center;
      display: flex;
      flex-direction: column;
    }
    
    #result-wrapper {
        display: flex;
        justify-content: space-between;
        width: 100%;
        margin-top: 1rem;
        flex-wrap: wrap; 
    }
    
    .result-item {
        flex: 1; 
        min-width: 45%; 
        text-align: center;
        padding: 0.5rem 0;
        /* Force single line for labels/values unless overridden by media query */
        white-space: nowrap; 
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    /* Center the single result in DiscRate mode */
    .result-item:only-child {
        flex: 0 0 100%;
    }
    
    /* Hide right border for single result */
    .result-item:only-child .result-divider {
        display: none;
    }

    .result-divider {
        border-right: 1px solid #333;
        height: 100%;
        position: absolute;
        right: 0;
        top: 0;
    }
    
    .result-item:first-child {
        position: relative;
    }
    
    .result-item:last-child {
        margin-left: 0.5rem; 
    }
    
    /* Media query for very small screens: stack results vertically */
    @media (max-width: 380px) {
      #result-wrapper {
        flex-direction: column;
      }
      .result-item {
        min-width: 100%;
        border: none !important;
        white-space: normal; /* Allow results to wrap */
      }
      .result-divider {
        display: none !important;
      }
    }
    /* --- Changes for Price Display Formatting --- */

    #result-label, #result-label-2 {
      font-size: clamp(0.8rem, 2vw, 1rem); 
      font-weight: 500;
      color: #ddd;
      margin-bottom: 0.5rem;
      display: block; 
      line-height: 1.2;
      white-space: normal; /* Labels should wrap */
    }
    
    .price-value {
        font-size: clamp(1.8rem, 5vw, 2.5rem); 
        font-weight: 800;
        display: block;
        line-height: 1.1;
    }

    #result-currency {
      background: linear-gradient(90deg, #ffffff, #ff0048);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-top: 0.5rem;
      display: inline-block;
    }

    #result-amount {
      background: linear-gradient(90deg, #ffffff, #ff0048);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: inline-block;
    }
    
    #result-currency-2 { 
      background: linear-gradient(90deg, #ffffff, #00fff2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-top: 0.5rem;
      display: inline-block;
    }

    #result-amount-2 {
      background: linear-gradient(90deg, #ffffff, #00fff2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: inline-block;
    }
    
    /* Style for DiscRate Mode result (which is just one span) */
    .rate-result {
        font-size: clamp(1.8rem, 5vw, 2.5rem); 
        font-weight: 800;
        background: linear-gradient(90deg, #ffffff, #ff0048);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-top: 0.5rem;
        display: block;
    }


    #result + span {
      font-size: clamp(2.2rem, 6vw, 3rem);
      font-weight: 800;
      color: #ff0048;
    }

    #message-box {
      margin-top: 1.5rem;
      padding: 0.9rem;
      border-radius: 0.7rem;
      text-align: center;
      display: none;
      font-weight: 500;
      font-size: 0.95rem;
    }

    .msg-success {
      background: #15803d;
    }

    .msg-error {
      background: #b91c1c;
    }

    #mode-indicator {
      text-align: center;
      color: #00ff04;
      font-size: 0.9rem;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1 id="main-title">Price DiscRate Calculator</h1>
    <p class="sub" id="sub-title">Calculate the discount rate between two prices.</p>

    <div class="input-group">
      <label id="label-a" for="price-a">Seted Price</label>
      <span id="span-a">Rs.</span>
      <input type="text" id="price-a" placeholder="e.g., 100">
    </div>

    <div class="input-group">
      <label id="label-b" for="price-b">Given Price</label>
      <span id="span-b">Rs.</span>
      <input type="text" id="price-b" placeholder="e.g., 80">
    </div>

    <button id="calculate-button">Calculate</button>

    <div id="result-container" style="display: none;">
        <div id="result-wrapper">
          <div class="result-item" id="result-item-1">
            <p id="result-label"></p>
            <div class="price-value" id="result-price-1">
              <span id="result-currency" style="white-space: nowrap;"></span>
              <span id="result-amount" style="white-space: nowrap;"></span>
            </div>
            <span id="result-rate-display" class="rate-result"></span> 
            <span class="result-divider"></span>
          </div>
          
          <div class="result-item" id="result-item-2" style="display:none;">
            <p id="result-label-2"></p>
            <div class="price-value" id="result-price-2">
              <span id="result-currency-2" style="white-space: nowrap;"></span>
              <span id="result-amount-2" style="white-space: nowrap;"></span>
            </div>
          </div>
        </div>
    </div>

    <div id="message-box"><p id="message-text"></p></div>
    </div>

  <script>
    const cardElement = document.querySelector('.card'); // Added reference to the card
    const titleElement = document.getElementById('main-title');
    const subtitleElement = document.getElementById('sub-title');
    const labelA = document.getElementById('label-a');
    const labelB = document.getElementById('label-b');
    const inputA = document.getElementById('price-a');
    const inputB = document.getElementById('price-b');
    const spanA = document.getElementById('span-a'); 
    const spanB = document.getElementById('span-b');
    const calculateButton = document.getElementById('calculate-button');
    const resultContainer = document.getElementById('result-container');
    const resultWrapper = document.getElementById('result-wrapper'); 
    const resultItem1 = document.getElementById('result-item-1'); 
    const resultItem2 = document.getElementById('result-item-2'); 
    const resultLabel = document.getElementById('result-label');
    const resultLabel2 = document.getElementById('result-label-2'); 
    
    // Updated Result Elements
    const resultPrice1 = document.getElementById('result-price-1');
    const resultCurrency = document.getElementById('result-currency');
    const resultAmount = document.getElementById('result-amount');
    const resultRateDisplay = document.getElementById('result-rate-display'); // Used only for Rate Mode
    
    const resultPrice2 = document.getElementById('result-price-2');
    const resultCurrency2 = document.getElementById('result-currency-2');
    const resultAmount2 = document.getElementById('result-amount-2');
    
    const messageBox = document.getElementById('message-box');
    const messageText = document.getElementById('message-text');

    let isDiscountRateMode = true;

    function setPriceDisplay(currencyEl, amountEl, displayContainer, value, currencyText) {
        currencyEl.textContent = currencyText;
        amountEl.textContent = value;
        displayContainer.style.display = 'block';
    }

    function clearPriceDisplays() {
        resultPrice1.style.display = 'none';
        resultRateDisplay.style.display = 'none';
        resultPrice2.style.display = 'none';
        resultCurrency.textContent = '';
        resultAmount.textContent = '';
        resultRateDisplay.textContent = '';
        resultCurrency2.textContent = '';
        resultAmount2.textContent = '';
    }


    function updateUI() {
      if (isDiscountRateMode) {
        titleElement.textContent = 'Price DiscRate Calculator';
        subtitleElement.textContent = 'Calculate the discount rate between two prices.';
        labelA.textContent = 'Seted Price';
        labelB.textContent = 'Given Price';
        calculateButton.textContent = 'Calculate Rate';
        inputA.placeholder = 'e.g., 100';
        inputB.placeholder = 'e.g., 80';
        resultLabel.textContent = 'The calculated rate is:';
        spanA.textContent = 'Rs.'; 
        spanB.textContent = 'Rs.'; 
        inputA.style.paddingLeft = '2.5rem';
        inputB.style.paddingLeft = '2.5rem';
        
        // Setup for single result (Rate Mode)
        resultItem2.style.display = 'none'; 
        resultItem1.style.flex = '0 0 100%';
        cardElement.classList.remove('wider-card'); // Ensure default width in Rate Mode
      } else {
        titleElement.textContent = 'Dis.Price Calculator';
        subtitleElement.textContent = 'Calculate the discount price.';
        labelA.textContent = 'Set Price';
        labelB.textContent = 'Discount Rate (%)';
        calculateButton.textContent = 'Calculate Price';
        inputA.placeholder = 'e.g., 100 or 100+50 or 100 50'; // Updated placeholder
        inputB.placeholder = 'e.g., 20';
        
        // Setup for dual results (Price Mode)
        resultLabel.textContent = 'The Final Price is:';
        resultLabel2.textContent = 'Discount:';
        resultItem2.style.display = 'block'; 
        resultItem1.style.flex = '1'; 

        spanA.textContent = 'Rs.';
        spanB.textContent = '%'; 
        inputA.style.paddingLeft = '2.5rem';
        inputB.style.paddingLeft = '2.5rem'; 
      }
      clearResults();
    }

    // Function to clean the input value.
    // For price A (Set Price) in Dis.Price Mode, it will now allow spaces and '+'.
    function cleanInput(value, isSummingPrice) {
      if (isSummingPrice) {
        // Allow digits, decimal point, space, and plus sign
        value = value.replace(/[^0-9. +]/g, "").trim();
      } else {
        // Only allow digits and a single decimal point (standard behavior), NO SPACE
        value = value.replace(/[^0-9.]/g, "");
        const parts = value.split(".");
        if (parts.length > 2) {
          value = parts[0] + "." + parts.slice(1).join("");
        }
      }
      return value;
    }

    // Function to get the numeric value, handling summing for price A in Discount Price Mode.
    function getNumericValue(input, isInputA, isDiscountRateMode) {
      const isSummingPrice = isInputA && !isDiscountRateMode;
      const cleaned = cleanInput(input.value, isSummingPrice);
      
      // Update the input field with the cleaned value (removes invalid chars but keeps delimiters for now)
      input.value = cleaned; 

      if (isSummingPrice) {
        // Replace spaces and '+' with a single space to split the numbers
        const numbersString = cleaned.replace(/[ +]+/g, ' ');
        const parts = numbersString.split(' ').filter(part => part.length > 0);
        
        let sum = 0;
        for (const part of parts) {
          const num = parseFloat(part);
          if (!isNaN(num)) {
            sum += num;
          }
        }
        
        // Update input A's display to show the calculated sum for clarity (optional, but helpful)
        if (sum > 0) {
            input.value = sum.toFixed(2).replace(/\.00$/, ''); // Show sum, remove .00 if integer
        } 
        
        return sum;
      }
      
      // Standard numeric parsing for Discount Rate Mode or input B
      return parseFloat(cleaned);
    }

    function calculate() {
      // Pass arguments to getNumericValue to enable conditional summing for input A
      const a = getNumericValue(inputA, true, isDiscountRateMode);
      const b = getNumericValue(inputB, false, isDiscountRateMode);

      resultContainer.style.display = 'none';
      messageBox.style.display = 'none';
      clearPriceDisplays(); // Clear the results before calculation
      cardElement.classList.remove('wider-card'); // Reset card width before new calculation

      if (isNaN(a) || a <= 0) {
        showMessage("Please enter a valid Set Price.", true);
        inputA.focus();
        return;
      }
      if (isNaN(b) || b < 0) {
        showMessage(`Please enter a valid value for the second field (${isDiscountRateMode ? 'Given Price' : 'Discount Rate'}).`, true);
        inputB.focus();
        return;
      }

      let calculatedResult;
      if (isDiscountRateMode) {
        // --- Discount Rate Mode Logic ---
        resultItem2.style.display = 'none'; 
        resultItem1.style.flex = '0 0 100%';
        if (a === 0) {
          showMessage("Seted Price cannot be zero for this calculation.", true);
          return;
        }
        calculatedResult = ((a - b) / a) * 100;
        
        // Display as single percentage span
        resultRateDisplay.textContent = `${truncateToTwo(calculatedResult).toFixed(2)}%`;
        resultRateDisplay.style.display = 'block';
        
        copyToClipboard(calculatedResult.toFixed(2));
      } else {
        // --- Discount Price Mode Logic ---
        resultItem2.style.display = 'block'; 
        resultItem1.style.flex = '1';
        
        // 1. Final Price 
        calculatedResult = a - (a * (b / 100));
        
        // MODIFICATION: Use toFixed(2)
        const finalPriceString = calculatedResult.toFixed(2); // Keep this precision
        setPriceDisplay(resultCurrency, resultAmount, resultPrice1, finalPriceString, 'Rs.');

        // NEW LOGIC: Check length and adjust card width
        // The length check includes all characters: digits, decimal point, and floating part.
        if (finalPriceString.length >= 7) { 
          cardElement.classList.add('wider-card');
        }

        // 2. Discount Amount (Set Price * Discount Rate)
        const setPriceRateProduct = a * (b / 100);
        const roundedUpProduct = Math.ceil(setPriceRateProduct);
        const finalproduct = roundedUpProduct.toFixed(0)
        
        // Display Discount Amount
        setPriceDisplay(resultCurrency2, resultAmount2, resultPrice2, finalproduct, 'Rs.');
        
        copyToClipboard(finalproduct); // Update copy to clipboard with new precision
      }

      resultContainer.style.display = 'flex';
    }

    function truncateToTwo(num) {
      return Math.floor(num * 100) / 100;
    }

    function showMessage(text, isError) {
      messageText.textContent = text;
      messageBox.style.display = 'block';
      messageBox.className = isError ? "msg-error" : "msg-success";
      setTimeout(() => { messageBox.style.display = 'none'; }, 4000);
    }

    function copyToClipboard(text) {
      const tempInput = document.createElement('input');
      tempInput.value = text;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);
    }
    
    function clearResults() {
      inputA.value = '';
      inputB.value = '';
      resultContainer.style.display = 'none';
      messageBox.style.display = 'none';
      clearPriceDisplays();
      cardElement.classList.remove('wider-card'); // Ensure default width is restored
      inputA.focus();
    }
    
    // --- UPDATED LOGIC FOR KEYDOWN (Allow Ctrl shortcuts, Block Space, Handle Letters) ---
    function handleInputKeydown(e) {
      // 0. IMPORTANT: If Ctrl or Meta (Cmd on Mac) is pressed, allow the default shortcut action (Ctrl+A, Ctrl+X, Ctrl+C, Ctrl+V, etc.)
      if (e.ctrlKey || e.metaKey) {
          return;
      }
      
      // 1. Block the space bar from being typed into *any* input field
      if (e.key === ' ') {
          e.preventDefault();
          return;
      }
      
      // 2. Block letters and convert to space (if applicable to inputA in Dis.Price Mode)
      if (e.key.length === 1 && e.key.match(/[a-zA-Z]/)) {
        e.preventDefault(); // Stop the letter from being typed
        
        // Only convert to space if in Discount Price Mode AND inputA (Set Price)
        if (!isDiscountRateMode && e.target === inputA) {
            const start = e.target.selectionStart;
            const end = e.target.selectionEnd;
            e.target.value = e.target.value.substring(0, start) + ' ' + e.target.value.substring(end);
            e.target.selectionStart = e.target.selectionEnd = start + 1;
        }
      }
    }
    // --- END UPDATED LOGIC ---
    
    
    // --- LOGIC FOR INPUT EVENT (Handle Pasting - Ctrl+V, and other non-keyboard inputs) ---
    function handleInputCleanup(e) {
        const input = e.target;
        // In Discount Price Mode:
        if (!isDiscountRateMode) {
            // inputB (Discount Rate) must NOT have spaces or letters.
            if (input === inputB) {
                // Remove all spaces and clean value
                input.value = input.value.replace(/[ \s]/g, '');
                input.value = cleanInput(input.value, false);
            }
            // inputA (Set Price) is allowed spaces/pluses for summing, but still clean of letters/symbols.
            else if (input === inputA) {
                // Use the logic from cleanInput which handles multiple prices with spaces/pluses
                input.value = cleanInput(input.value, true);
            }
        }
        // In Discount Rate Mode:
        else {
            // Both inputs must be clean of spaces and letters/symbols
            input.value = cleanInput(input.value, false);
        }
    }
    // --- END LOGIC FOR INPUT EVENT ---

    // Apply the listeners
    inputA.addEventListener('keydown', handleInputKeydown);
    inputB.addEventListener('keydown', handleInputKeydown);
    
    // This is crucial for cleaning pasted content (Ctrl+V) after the paste operation completes
    inputA.addEventListener('input', handleInputCleanup); 
    inputB.addEventListener('input', handleInputCleanup); 
    
    
    calculateButton.addEventListener('click', calculate);

    // Global Space Bar Listener (Always switches mode)
    document.addEventListener('keydown', e => {
      if (e.key === ' ') {
        e.preventDefault(); 
        isDiscountRateMode = !isDiscountRateMode;
        updateUI();
      }
    });

    inputA.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        if (inputA.value && inputB.value) {
          calculate();
        } else {
          inputB.focus();
        }
      }
    });

    inputB.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        calculate();
      }
    });

    function clearInputOnDoubleClick(e) {
      e.target.value = '';
    }

    inputA.addEventListener('dblclick', clearInputOnDoubleClick);
    inputB.addEventListener('dblclick', clearInputOnDoubleClick);

    window.onload = () => updateUI();

  </script>
</body>
</html>
